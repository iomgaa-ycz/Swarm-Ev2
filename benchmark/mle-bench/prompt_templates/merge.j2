{# ===================================================================== #}
{# MERGE TASK PROMPT TEMPLATE                                          #}
{# 用于执行基因交叉，合并两个父节点的基因块                                  #}
{# ===================================================================== #}

{# SECTION: ROLE [EVOLVABLE] #}
{{ load_agent_config(agent_id, "role") }}
{# END SECTION: ROLE #}

{# SECTION: FORMAT [STATIC_SKILL] #}
{{ load_skill("static/output_format") }}
{# END SECTION: FORMAT #}

{# SECTION: TASK #}
# Task: Genetic Crossover

You are performing **genetic crossover** to create a child solution
by combining gene blocks from multiple source solutions.

## Reference Solution (fitness={{ primary_parent.metric_value if primary_parent.metric_value else "N/A" }})

A complete working solution for structural reference (imports, helpers, main logic):

```python
{{ primary_parent.code }}
```

{% if primary_parent.term_out %}
### Execution Result
```
{{ primary_parent.term_out[:1000] }}{% if primary_parent.term_out|length > 1000 %}... (truncated){% endif %}
```
{% endif %}

---

## Gene Plan

The following specifies the selected gene block for each section:

{{ gene_plan }}

**Your Task**: Create a child solution that:
1. Uses the gene block code from each section above
2. Uses the Reference Solution as structural scaffold (imports, helpers, main logic)
3. Resolves any conflicts between blocks from different sources
4. Ensures the merged solution is executable and coherent
{# END SECTION: TASK #}

{# SECTION: STRATEGY [HYBRID] #}
{{ load_skill("by_task_type/merge/crossover_strategies") }}

{{ load_skill("by_task_type/merge/conflict_resolution") }}

{{ load_agent_config(agent_id, "strategy_merge") }}
{# END SECTION: STRATEGY #}

{# SECTION: EXAMPLES [DYNAMIC_SKILL] #}
{% if dynamic_skills %}
{{ dynamic_skills }}
{% endif %}
{# END SECTION: EXAMPLES #}

{# SECTION: GUIDELINES #}
{{ load_skill("static/workspace_rules") }}

{{ load_skill("static/code_style") }}

## Validation Checklist

After merging, ensure:
- [ ] All 7 gene blocks are present (DATA, MODEL, LOSS, OPTIMIZER, REGULARIZATION, INITIALIZATION, TRAINING_TRICKS)
- [ ] Gene plan is followed strictly (unless conflicts require adaptation)
- [ ] Conflicts are documented and resolved
- [ ] Code is syntactically correct and executable
- [ ] Model input/output shapes are compatible
- [ ] Validation metric is printed
- [ ] Predictions are saved to `./submission/submission.csv`

## System Environment

- **Device**: {{ device_info | default("CPU only") }}
- **Conda Environment**: `{{ conda_env_name | default("python") }}`
{% if conda_packages %}- **Installed Packages**: {{ conda_packages }}
{% endif %}
{# END SECTION: GUIDELINES #}
