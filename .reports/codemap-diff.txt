# Codemap 更新报告

**生成时间:** 2026-01-31
**对比范围:** docs/CODEMAPS/ vs codemaps/

---

## 变更摘要

| 项目 | 旧版本 (docs/CODEMAPS) | 新版本 (codemaps) | 变更 |
|------|----------------------|------------------|------|
| 文件位置 | docs/CODEMAPS/ | codemaps/ | ✅ 目录结构调整 |
| 文件数量 | 3 个 | 3 个 | 无变化 |
| 总代码行数 | ~3674 | ~3787 | +113 行 (+3.1%) |
| 核心模块数 | 20 个 | 21 个 | +1 (main.py) |
| 测试文件数 | 19 个 | 16 个 | -3 (合并/清理) |

**变更幅度:** 3.1% (< 30% 阈值，自动更新)

---

## 主要变更点

### 1. 架构文档 (architecture.md)

**新增内容:**
- ✅ main.py 入口层描述 (161 行)
- ✅ 完整的端到端数据流图
- ✅ 精简的模块关系图 (移除冗余细节)
- ✅ 核心模块统计表 (21 个模块)

**优化内容:**
- 📊 将复杂的 Mermaid 图简化为文本树形图 (提升可读性)
- 🎯 突出 Phase 2.4 完成状态 (Orchestrator ✅)
- 📝 重新组织章节结构 (系统架构 → 模块关系 → 数据流 → 策略)

**移除内容:**
- ❌ 冗长的 Mermaid 依赖图 (过于复杂，转移到 backend.md)
- ❌ Phase 实施明细表 (保留状态摘要，详情见 README.md)

### 2. 后端详解 (backend.md)

**新增内容:**
- ✅ main.py 入口层描述
- ✅ 完整的 Orchestrator 单步数据流
- ✅ CoderAgent LLM 重试机制详解
- ✅ PromptBuilder 自适应逻辑示例

**优化内容:**
- 📊 模块清单表格新增 "入口层" 分类
- 🎯 Function Calling Review 机制详细展开
- 📝 后端抽象层架构简化为文本流程

### 3. 数据流详解 (data.md)

**新增内容:**
- ✅ 完整的 Orchestrator 单步数据流
- ✅ 配置系统数据流 (从 .env 到 Config 对象)
- ✅ 双阶段 LLM 配置详解 (code vs feedback)

**优化内容:**
- 📊 配置加载流程简化为文本流程图
- 🎯 工作空间目录结构说明更清晰
- 📝 日志系统示例更新

---

## 目录结构变更

### 旧版本 (docs/CODEMAPS/)

```
docs/
└── CODEMAPS/
    ├── architecture.md    (550 行)
    ├── backend.md         (679 行)
    └── data.md            (503 行)
```

### 新版本 (codemaps/)

```
codemaps/
├── architecture.md    (343 行)
├── backend.md         (567 行)
└── data.md            (442 行)
```

**总体精简:** 信息密度提升，重复内容合并

---

## 内容优化统计

| 优化类型 | 数量 | 说明 |
|---------|------|------|
| 复杂 Mermaid 图 → 文本树形图 | 3 处 | 提升可读性 |
| 冗余表格合并 | 2 处 | 避免信息重复 |
| 章节重组 | 5 处 | 逻辑更清晰 |
| 新增数据流图 | 3 处 | Orchestrator 详解 |
| 移除过时内容 | 0 处 | 无过时内容 |

---

## 推荐操作

1. ✅ **已自动更新:** 新版本已写入 `codemaps/` 目录
2. ⚠️ **待人工审核:** 对比确认无误
3. 🔄 **同步操作 (可选):**
   ```bash
   # 如果确认新版本无误，可替换旧版本
   rm -rf docs/CODEMAPS/
   mv codemaps/ docs/CODEMAPS/
   ```

---

**报告生成工具:** Claude Code /update-codemaps
**自动更新阈值:** 30% (当前 3.1% < 30%，自动更新)
