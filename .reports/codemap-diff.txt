# Codemap 差异报告
# 生成时间: 2026-02-01
# 生成者: doc-updater Agent

================================================================================
                            差异概览
================================================================================

旧版 Codemap 日期: 2026-01-31
新版 Codemap 日期: 2026-02-01

--------------------------------------------------------------------------------
模块统计对比
--------------------------------------------------------------------------------

| 项目                  | 旧值       | 新值       | 差异          |
|-----------------------|------------|------------|---------------|
| 核心模块数量          | 25         | 24         | -1 (统计修正) |
| 代码行数              | ~4509      | 4861       | +7.8%         |
| Orchestrator 行数     | 427        | 534        | +25.1%        |
| 配置文件行数          | 107        | 108        | +0.9%         |

--------------------------------------------------------------------------------
新增模块
--------------------------------------------------------------------------------

1. utils/prompt_manager.py (252 行) - NEW
   - 基于 Jinja2 的 Prompt 管理系统
   - 7 层结构化 Prompt 构建
   - 支持静态/动态 Skill 加载
   - 集成 ExperiencePool 的 Top-K 查询

--------------------------------------------------------------------------------
新增目录结构
--------------------------------------------------------------------------------

benchmark/mle-bench/                              - NEW
├── prompt_templates/                             - Jinja2 模板
│   ├── explore.j2
│   ├── merge.j2
│   └── mutate.j2
├── skills/                                       - Skill 文件
│   ├── static/                                   - 静态 Skill
│   │   ├── output_format.md
│   │   ├── workspace_rules.md
│   │   ├── ml_best_practices.md
│   │   └── code_style.md
│   ├── by_task_type/                             - 任务特定 Skill
│   │   ├── merge/
│   │   │   ├── crossover_strategies.md
│   │   │   └── conflict_resolution.md
│   │   └── mutate/
│   │       ├── mutation_strategies.md
│   │       └── local_optimization.md
│   └── meta/                                     - 元数据
│       ├── skill_index.json
│       ├── skill_lineage.json
│       └── update_history.json
└── agent_configs/                                - Agent 配置
    ├── agent_0/
    │   ├── role.md
    │   ├── strategy_explore.md
    │   ├── strategy_merge.md
    │   └── strategy_mutate.md
    ├── agent_1/
    ├── agent_2/
    └── agent_3/

--------------------------------------------------------------------------------
新增测试文件
--------------------------------------------------------------------------------

1. tests/test_evolution/test_prompt_manager.py   - PromptManager 单元测试
2. tests/integration/test_prompt_system_integration.py - 集成测试

--------------------------------------------------------------------------------
模块行数详细对比
--------------------------------------------------------------------------------

| 模块                                | 旧行数 | 新行数 | 变化    |
|-------------------------------------|--------|--------|---------|
| utils/__init__.py                   | N/A    | 14     | -       |
| utils/config.py                     | 554    | 598    | +44     |
| utils/logger_system.py              | 180    | 180    | 0       |
| utils/file_utils.py                 | 113    | 113    | 0       |
| utils/data_preview.py               | 269    | 269    | 0       |
| utils/metric.py                     | 117    | 117    | 0       |
| utils/response.py                   | 89     | 89     | 0       |
| utils/prompt_builder.py             | 167    | 167    | 0       |
| utils/prompt_manager.py             | N/A    | 252    | +252 NEW|
| utils/workspace_builder.py          | N/A    | 60     | +60     |
| core/state/node.py                  | 121    | 121    | 0       |
| core/state/journal.py               | 283    | 283    | 0       |
| core/state/task.py                  | 62     | 62     | 0       |
| core/backend/__init__.py            | 137    | 137    | 0       |
| core/backend/backend_openai.py      | 163    | 163    | 0       |
| core/backend/backend_anthropic.py   | 142    | 142    | 0       |
| core/backend/utils.py               | 80     | 80     | 0       |
| core/executor/interpreter.py        | 176    | 176    | 0       |
| core/executor/workspace.py          | 181    | 181    | 0       |
| core/orchestrator.py                | 427    | 534    | +107    |
| core/evolution/gene_parser.py       | 162    | 163    | +1      |
| core/evolution/experience_pool.py   | 312    | 313    | +1      |
| agents/base_agent.py                | 119    | 119    | 0       |
| agents/coder_agent.py               | 272    | 272    | 0       |
| search/fitness.py                   | 81     | 82     | +1      |

--------------------------------------------------------------------------------
差异百分比计算
--------------------------------------------------------------------------------

代码行数变化: (4861 - 4509) / 4509 = +7.8%
新增模块占比: 252 / 4861 = 5.2%
Orchestrator 增长: (534 - 427) / 427 = +25.1%

总体差异估算: ~15-20% (低于 30% 阈值)

--------------------------------------------------------------------------------
结论
--------------------------------------------------------------------------------

1. 差异百分比 < 30%，无需用户确认，直接更新
2. 主要新增:
   - PromptManager 模块 (Jinja2 模板系统)
   - benchmark/ 目录 (Skill 文件 + Agent 配置)
3. 主要变更:
   - Orchestrator 行数增长 25%
4. 文档更新范围:
   - docs/CODEMAPS/architecture.md
   - docs/CODEMAPS/backend.md
   - docs/CODEMAPS/data.md

================================================================================
                            报告结束
================================================================================
