# MLE-Bench 实验结果深度分析报告

> **实验配置**: glm-4.7 模型 + 4 Agent 群体进化 | 13 个 Kaggle 竞赛 | 10 Epoch x 10 Steps
>
> **总成绩**: 12/13 有效提交，4 枚奖牌（3 金 1 银），7/13 超中位数
>
> **分析日期**: 2026-02-10

---

## 一、总览仪表盘

| # | 竞赛 | 类型 | 提交得分 | 方向 | 中位数 | 奖牌线 | 结果 | 内部最佳 | 内外Gap | 成功率 | 耗时 |
|---|------|------|---------|------|--------|--------|------|---------|---------|--------|------|
| 1 | aerial-cactus | 图像分类 | 0.99999 | ↑ | 0.9991 | 1.0(金) | 超中位 | 1.0000 | 0.00001 | 40.5% | 13.5h |
| 2 | aptos2019 | 图像分类 | 0.88567 | ↑ | 0.8889 | 0.9145(铜) | **低于中位** | 0.9227 | **0.037** | 27.3% | 20.6h |
| 3 | denoising | 图像去噪 | null | ↓ | 0.0733 | 0.0452(铜) | **无效提交** | 0.0008 | N/A | 34.6% | 19.5h |
| 4 | detecting-insults | NLP | 0.91668 | ↑ | 0.7784 | 0.8332(金) | **金牌** | 0.9099 | 0.007 | 41.0% | 9.8h |
| 5 | dog-breed | 图像分类 | 0.51171 | ↓ | 0.4721 | 0.0460(铜) | **低于中位** | 0.2720 | **0.240** | 32.5% | 17.6h |
| 6 | dogs-vs-cats | 图像分类 | 0.06816 | ↓ | 0.1222 | 0.0613(铜) | 超中位 | 0.0089 | **0.059** | 25.0% | 18.6h |
| 7 | histopathologic | 图像分类 | 0.99757 | ↑ | 0.9477 | 0.9835(金) | **金牌** | 0.9975 | 0.000 | 39.6% | 29.7h |
| 8 | jigsaw-toxic | NLP | 0.97938 | ↑ | 0.9808 | 0.9864(铜) | **低于中位** | 0.9877 | **0.008** | 28.3% | 24.9h |
| 9 | leaf-classification | 表格多分类 | 0.9954 | ↓ | 0.1084 | 0.0153(铜) | **低于中位** | 0.0000 | **0.995** | 18.5% | 13.7h |
| 10 | mlsp-birds | 音频分类 | 0.76296 | ↑ | 0.8657 | 0.8737(铜) | **低于中位** | 0.7672 | 0.004 | 20.0% | 6.7h |
| 11 | nomad2018 | 表格回归 | 0.06111 | ↓ | 0.0699 | 0.0658(铜) | **银牌** | 0.0570 | 0.004 | 35.3% | 16.0h |
| 12 | plant-pathology | 图像分类 | 0.99594 | ↑ | 0.9485 | 0.9784(金) | **金牌** | 0.9878 | 0.008 | 29.4% | 17.0h |
| 13 | random-acts-of-pizza | 表格二分类 | 0.66504 | ↑ | 0.5996 | 0.6921(铜) | 超中位 | 0.6865 | 0.021 | 37.4% | 12.6h |

**汇总**: 4 奖牌(3金1银) / 7 超中位数 / 5 低于中位数 / 1 无效提交

---

## 二、逐竞赛分析卡片

### A层 -- 获奖竞赛（提取成功模式）

#### detecting-insults -- 金牌 (0.917 vs 金牌线 0.833, +0.083)

- **方案**: 5模型 Stacking（3 个 char n-gram TF-IDF+SVM + 1 个 word TF-IDF+SVM + 1 个 TF-IDF+LightGBM+ProfanityScorer），Meta: LogisticRegression
- **成功因素**: 多粒度 char/word TF-IDF + 领域脏话词典 + 异构模型 Stacking + 纯 sklearn 执行快
- **进化轨迹**: 0.902 → 0.910（+0.008），Epoch 1 起步已很高，后续微调
- **可复制模式**: NLP二分类用 Stacking + 多粒度TF-IDF；领域特征注入

#### histopathologic -- 金牌 (0.998 vs 金牌线 0.984, +0.014)

- **方案**: ResNet50 预训练 + AMP混合精度 + TTA(3变换平均: 原始+水平翻转+垂直翻转)
- **成功因素**: TTA 是关键差异化；翻转/旋转完美匹配病理图像无方向性；Buggy率仅30%（全竞赛最低），SolEvo成功率91.2%
- **进化轨迹**: 0.996 → 0.997（+0.002），初始即极高
- **可复制模式**: 图像分类标配 TTA；AMP 加速训练

#### plant-pathology -- 金牌 (0.996 vs 金牌线 0.978, +0.018)

- **方案**: EfficientNet-B0 + MixUp(alpha=0.2) + OneCycleLR(warmup 30%) + BCEWithLogitsLoss
- **成功因素**: MixUp 对仅 1821 样本的小数据集提供强正则化；OneCycleLR warmup 保护预训练权重；轻量模型防过拟合
- **进化轨迹**: 0.979 → 0.988（+0.009）
- **可复制模式**: 小数据集 CV 用 MixUp+EfficientNet+OneCycleLR 三件套

#### nomad2018 -- 银牌 (0.061 vs 银牌线 0.062, 差金牌 0.005)

- **方案**: LightGBM + 领域特征工程（晶胞体积、加权电负性、组分比率）+ log1p 目标变换
- **成功因素**: 物理化学先验特征 + log1p 精确对齐 RMSLE 指标 + 执行极快(~5s/iter)
- **进化轨迹**: 0.062 → 0.057（-0.005，越小越好）
- **可复制模式**: 表格任务用 LightGBM + 领域特征 + 目标变换对齐评估指标

---

### B层 -- 极度接近获奖

#### aerial-cactus -- 差 0.00001 到金牌

- **方案**: 自定义 ResNet-9 + MixUp(alpha=0.4) + AdamW + CosineAnnealingLR
- **瓶颈**: 验证集 AUC=1.0 但测试集 0.99999，存在极少量边界样本排序误差。无 TTA、无模型集成
- **改进**: **加 TTA（水平翻转+旋转取平均）** 几乎可确定突破 -> 金牌

#### dogs-vs-cats -- 差 0.007 到铜牌

- **方案**: ResNet-34 预训练 + BCEWithLogitsLoss + AdamW
- **瓶颈**: **严重过拟合** -- 内部 metric 0.0089 vs 提交 0.0682（Gap 0.059）。10% 验证集太小；单一模型；进化后期大量 merge 退化到 0.21x
- **改进**: **K-Fold 5折 CV + 模型集成** -> 预计可达铜牌

---

### C层 -- 低于中位数（诊断根因）

#### aptos2019 -- 差 0.003 到中位数

- **根因**: **阈值过拟合 + 分辨率不足**
- 内部 QWK 0.923 但提交仅 0.886（Gap 0.037）。OptimizedRounder 阈值在 ~495 样本验证集上过拟合；224x224 对高分辨率视网膜图像过低
- **改进**: K-Fold CV 稳定阈值估计 + 提升分辨率到 384+

#### jigsaw-toxic -- 差 0.001 到中位数

- **根因**: **模型天花板**
- TF-IDF + LogisticRegression 的 AUC 上限约 0.988。Epoch 5 后完全停滞（连续 5 epoch 无改进）
- **改进**: 移除 class_weight='balanced' + 调优正则化 C 值（最小成本改动）

#### dog-breed -- 低于中位数 0.04

- **根因**: **Focal Loss 与评估指标不匹配**
- 竞赛评估用 logloss，但代码使用 Focal Loss (gamma=2.0) 训练
- `if val_loss < best_val_loss` 用 Focal Loss 值做模型选择，而非 logloss -- 选出的模型不是 logloss 最优的
- Focal Loss 会使概率分布"变平"，反而增大 logloss
- 内部 metric 0.272（Focal Loss 值）vs 实际 test logloss 0.512
- **改进**: 改用 CrossEntropyLoss + logloss 作为模型选择依据；分层学习率（backbone lr=1e-5, head lr=1e-3）

#### leaf-classification -- 严重偏离（logloss 0.995 vs 中位 0.108）

- **根因**: **致命策略错误 -- 丢弃原始特征 + Reviewer metric 幻觉**
- solution.py 只用了 ~26 维工程聚合特征（均值、方差、分位数），**丢弃了 192 维原始特征**（margin/shape/texture 各 64 维）
- 更严重: Epoch 5 出现 **metric=0.0 的虚假值**（logloss 不可能为 0），节点被标记为 is_buggy=False，此后系统**死锁在这个假方案上**
- **改进**: **保留 192 维原始特征 + 工程特征** -> 预计 logloss 可降至 0.05 以下（金牌区间）；**增加 metric 合理性校验**

#### mlsp-birds -- 大幅落后（AUC 0.763 vs 中位 0.866）

- **根因**: **explore 成功率 0% + 数据利用严重不足**
- 126 次 explore 全部失败！只有 improve 操作成功（20/74=27%）
- 代码仅使用 `histogram_of_segments.txt` 的 100 维特征，忽略了 segment_features.txt（1120行）、filtered_spectrograms、原始 wav 等丰富数据
- **改进**: 修复 explore 模板使其能正确处理音频特征；融合 segment_features + spectrogram 特征

---

### D层 -- 无效提交

#### denoising-dirty-documents -- valid_submission=false

- **根因**: **双重归一化 bug + 提交行数缺失**
- `transforms.ToTensor()` 已将 PIL Image 归一化到 [0,1]，代码又执行 `/ 255.0`，导致训练输入范围 [0, 1/255]，而测试输入范围 [0,1] -- 输入域完全错位，输出全为 0
- 提交文件 4,040,280 行 vs 预期 5,789,880 行（缺 30%），因 `CenterCrop` 裁剪后按裁剪尺寸生成 pixel_id
- 内部进化 metric 实际很好（0.084->0.001），UNet 去噪方案本身可行
- **改进**: 移除 `/ 255.0`；按原始图像尺寸输出

---

## 三、系统架构层面问题

### 3.1 进化效率

| 指标 | 数值 | 评估 |
|------|------|------|
| 全局平均成功率 | **31.5%** | 偏低，68.5% 的计算资源浪费在 buggy 代码上 |
| 最高成功率 | detecting-insults 41.0% | 纯 sklearn 方案代码稳定性最好 |
| 最低成功率 | leaf-classif 18.5% | 表格任务反而最不稳定 |
| SolEvo 内部最高 | histopathologic **91.2%** | ResNet50 模板高度稳定 |
| SolEvo 内部最低 | detecting-insults 31.9% | Stacking 代码复杂度导致 merge 失败率高 |
| 全局总评估节点 | 966 | 13 竞赛合计 |
| 全局总成功节点 | 303 | 成功率 31.4% |

### 3.2 三种任务类型成效分析（explore / merge / mutate）

系统实际使用 **3 种任务类型**，而非仅 explore 和 improve。完整定义：

| 任务类型 | 功能 | 机制 |
|---------|------|------|
| **explore** | 探索新方案（含初稿、修复、改进） | 从零生成或基于父节点改进代码 |
| **merge** | 合并方案（遗传交叉） | 从两个父代中按 7 基因块选优组合 |
| **mutate** | 基因变异 | 随机选择 1 个基因块（DATA/MODEL/LOSS/OPTIMIZER/REGULARIZATION/INITIALIZATION/TRAINING_TRICKS）进行定向改进 |

#### 全局统计（1,103 个任务）

| 任务类型 | 总数 | 成功 | 失败 | 成功率 | 占比 |
|---------|------|------|------|--------|------|
| **merge** | 613 | 286 | 327 | **46.7%** | 55.6% |
| **mutate** | 154 | 66 | 88 | **42.9%** | 14.0% |
| **explore** | 336 | 99 | 237 | **29.5%** | 30.5% |
| 总计 | 1,103 | 451 | 652 | 40.9% | 100% |

**核心发现**: merge > mutate > explore 的成功率排序。merge 作为占比最大（55.6%）且成功率最高（46.7%）的操作，是系统进化的主力引擎。

#### 逐竞赛三种任务类型成功率

| 竞赛 | explore 成功率 | merge 成功率 | mutate 成功率 | 最有效操作 | 结果 |
|------|-------------|------------|-------------|-----------|------|
| histopathologic | **58.3%** | **91.2%** | **90.9%** | merge | 金牌 |
| detecting-insults | 41.7% | 31.9% | 18.2% | explore | 金牌 |
| aptos-blindness | 41.7% | 50.0% | 100%(1/1) | merge | 低于中位 |
| aerial-cactus | 37.5% | 46.0% | 33.3% | merge | 超中位 |
| random-pizza | 37.5% | 46.8% | 33.3% | merge | 超中位 |
| nomad-conductors | 25.0% | 54.0% | 41.7% | merge | 银牌 |
| plant-pathology | 27.3% | 37.9% | 30.8% | merge | 金牌 |
| dog-breed | 29.2% | 37.1% | 26.3% | merge | 低于中位 |
| dogs-vs-cats | 16.7% | 36.4% | 27.3% | merge | 超中位 |
| denoising | 33.3% | 33.3% | 35.3% | mutate | 无效提交 |
| leaf-classif | 25.0% | 34.0% | 18.2% | merge | 低于中位 |
| jigsaw-toxic | 16.7% | 45.2% | 25.0% | merge | 低于中位 |
| mlsp-birds | **0.0%** | 61.8% | 28.6% | merge | 低于中位 |

**关键发现**:

1. **merge 在 11/13 个竞赛中是最有效的操作类型**，仅 detecting-insults（explore 更强）和 denoising（mutate 微幅领先）例外
2. **explore 成功率波动最大**（0%~58.3%），mlsp-birds 的 126 次 explore 全部失败是极端案例
3. **mutate 样本量小但有诊断价值**: histopathologic 的 mutate 成功率 90.9% 说明代码质量高、单基因优化空间大；detecting-insults 仅 18.2% 说明 Stacking 代码结构对单点变异敏感
4. **获奖竞赛的共性**: 至少有一种操作成功率 ≥40%，保证了进化预算不被大量浪费

#### 任务类型调度策略评估

当前使用 **Epsilon-Greedy 策略**（epsilon=0.3），70% 时间选擅长度最高的 Agent，30% 随机探索。

- **优点**: 能动态适应不同竞赛的 Agent 能力分布
- **缺点**: 任务类型分配比例固定（explore:merge:mutate ≈ 30:56:14），未根据进化阶段调整
- **建议**: 前期增加 explore 比例（初始多样性），中后期增加 merge 比例（加速收敛），后期增加 mutate 比例（精细调优）

### 3.3 内部验证 vs 测试提交 Gap（核心系统问题）

| 竞赛 | 内部最佳 | 提交得分 | Gap | Gap 方向 |
|------|---------|---------|-----|---------|
| leaf-classif | 0.000 | 0.995 | **0.995** | 内部乐观（虚假 metric） |
| dog-breed | 0.272 | 0.512 | **0.240** | 内部乐观（指标不匹配） |
| dogs-vs-cats | 0.009 | 0.068 | **0.059** | 内部乐观（过拟合） |
| aptos2019 | 0.923 | 0.886 | **0.037** | 内部乐观（阈值过拟合） |
| random-acts | 0.686 | 0.665 | 0.021 | 内部乐观 |
| jigsaw-toxic | 0.988 | 0.979 | 0.008 | 内部乐观 |
| plant-pathology | 0.988 | 0.996 | 0.008 | 内部**悲观** |
| histopathologic | 0.997 | 0.998 | 0.000 | 几乎一致 |

**结论**: **11/13 竞赛内部 metric 比实际提交更乐观**，这是进化系统的系统性问题 -- 选择压力基于过拟合的验证指标，导致进化方向偏离真实测试集表现。

### 3.4 超时与 LLM 稳定性

| 指标 | 数据 |
|------|------|
| 代码执行超时总次数 | 80 次 |
| 超时最严重 | leaf-classif(13次), nomad(12次), jigsaw(11次) |
| 唯一无超时 | mlsp-birds |
| LLM 调用失败总次数 | 102 次（集中在 3 个竞赛） |
| LLM 失败最严重 | plant-pathology(47次), random-pizza(34次), nomad(21次) |
| 无 LLM 问题的竞赛 | 10/13 个 |

3 个有 LLM 失败的竞赛是按时间顺序最后运行的，推测与 API rate limit 累积触发相关。

### 3.5 任务类型维度分析

| 类型 | 竞赛数 | 奖牌数 | 奖牌率 | 系统性弱点 |
|------|-------|--------|--------|-----------|
| 图像分类（简单） | 3 | 1金 | 33% | 缺少 TTA 和 K-Fold |
| 图像分类（细粒度） | 3 | 1金 | 33% | 分辨率不足、过拟合 |
| NLP 分类 | 2 | 1金 | 50% | 模型天花板（无深度学习） |
| 表格数据 | 3 | 1银 | 33% | 特征工程策略不稳定 |
| 特殊任务 | 2 | 0 | **0%** | 非标准任务完全失败 |

### 3.6 跨竞赛可复制成功模式

| # | 模式 | 适用场景 | 证据 |
|---|------|---------|------|
| 1 | **异构模型 Stacking** | NLP 分类 | detecting-insults 金牌 (5模型); random-acts-pizza 单模型未获奖 |
| 2 | **多粒度 TF-IDF (char+word)** | 文本分类 | detecting-insults 金牌核心策略 |
| 3 | **TTA (Test Time Augmentation)** | 图像分类 | histopathologic 金牌 (3变换平均) |
| 4 | **MixUp + OneCycleLR** | 小数据集 CV | plant-pathology 金牌 (仅 1821 样本) |
| 5 | **Log1p 目标变换对齐 RMSLE** | 回归 + RMSLE 指标 | nomad2018 银牌 |
| 6 | **领域特征工程** | 结构化数据 | nomad2018(物理公式), detecting-insults(脏话词典) |
| 7 | **预训练模型 + 适当增强** | CV 任务 | histopathologic(ResNet50), plant-pathology(EfficientNet-B0) |
| 8 | **低 Buggy 率 = 更多有效迭代** | 所有场景 | histopathologic 30% buggy 最佳; 高 buggy 浪费进化预算 |

---

## 四、进化机制对最终效果的深度分析

### 4.1 双层进化架构概述

Swarm-Ev2 采用**双层进化架构**：

```
Agent 层进化（每 3 Epoch 触发）
  ├── 4 个 Coder Agent 竞争执行任务
  ├── TaskDispatcher: Epsilon-Greedy 选择最优 Agent
  └── 弱者 Agent 的 Role/Strategy 变异（LLM 驱动）

Solution 层进化（每 Epoch 末触发 GA）
  ├── 精英保留: elite_size=3
  ├── 锦标赛选择: tournament_k=3
  ├── 交叉(merge): crossover_rate=0.8，按 7 基因块选优组合
  ├── 变异(mutate): mutation_rate=0.2，单基因块定向改进
  └── 种群大小: population_size=12
```

7 个基因块（进化最小单位）：`DATA | MODEL | LOSS | OPTIMIZER | REGULARIZATION | INITIALIZATION | TRAINING_TRICKS`

### 4.2 获奖竞赛的进化轨迹分析

#### detecting-insults（金牌）-- 教科书式进化

```
进化轨迹（9 次突破）:
0.902 → 0.904 → 0.905 → 0.906 → 0.908 → 0.908 → 0.910 → 0.910 → 0.910
 [快速爬升 0-4h]          [定向改进 4-6h]          [精细调优 6-8h]
```

- **前期（0-2h）**: 高 explore 多样性，5 个初稿（num_drafts=5）覆盖不同策略
- **中期（2-5h）**: 关键节点 04b629a1（metric=0.9097）被选为父代 **8 次**，与 5 个不同高性能节点交叉，子代中 62.5% 保持或提升性能
- **后期（5-8h）**: 开始出现自交（68e1e308 × 68e1e308），但 LLM 的**语义层面创意**仍能从同质父代产生微幅改进
- **成功机制**: 充足育种池(12)容纳实验 + 好节点的遗传稳定性高

#### histopathologic（金牌）-- 高精度微调范式

```
进化轨迹（3 次突破）:
0.9966 → 0.9974 → 0.9975
 [每次突破 < 0.001]
```

- merge 成功率 **91.2%**（全竞赛最高），代码模板高度稳定
- 最优解通过**自交**产生: merge(20a8a91c, 20a8a91c)
- **启示**: 高精度场景下，局部搜索深化比多样性更重要

#### plant-pathology（金牌）-- 稳定上升范式

```
进化轨迹（5 次突破）:
0.9803 → 0.9829 → 0.9831 → 0.9869 → 0.9878
 [均匀分布在 15h 内]
```

- 最大单次跳跃 +0.0039（基因块优化的累积效应）
- 但末期种群同质化严重：最终 Epoch 的 6 个 merge 节点全部 BUGGY

#### nomad2018（银牌）-- 表格任务的进化突破

```
进化轨迹（3 次突破，↓越小越好）:
0.0619 → 0.0619 → 0.0570
 [中期停滞]    [末期突破 -8%]
```

- 前期 explore 快速找到 LightGBM + 领域特征的基线
- 中期停滞后通过 mutate(TRAINING_TRICKS) 引入 log1p 目标变换，实现末期突破

### 4.3 失败竞赛的进化病理分析

#### leaf-classification -- "虚假 metric 污染"导致进化崩溃

```
进化轨迹（6 次"突破"，↓越小越好）:
0.621 → 0.289 → 0.265 → 0.256 → 0.242 → 0.000
 [持续下降]                              [metric 归零 = 代码崩溃]
```

- **致命事件**: Epoch 5 出现 metric=0.0 的虚假节点（logloss 不可能为 0），被标记为 is_buggy=False
- **连锁反应**: 该虚假节点成为 best_node → 后续所有 merge/mutate 都基于它 → 种群被污染
- **后期统计**: 最后 100 个节点中 80 个 BUGGY，系统仍在尝试 merge，纯粹浪费计算
- **根因**: **缺乏 metric 合理性校验 + 缺乏进化停滞检测**

#### mlsp-birds -- "多样性崩溃"导致进化停滞

```
进化轨迹（7 次突破）:
0.727 → 0.728 → 0.747 → 0.747 → 0.748 → 0.752 → 0.767
 [增速递减: Δ=0.020 → Δ=0.001 → Δ=0.015]
```

- **explore 成功率 0%**: 126 次全部失败，系统只能靠 merge(61.8%) 和 improve 前进
- **末期自交泛滥**: 最终 Epoch 中 b0291892 自交 4 次，07733d44 自交 2 次
- **种群同质化**: 精英保留过度约束（elite_size=3 占种群 25%），新节点无法表达
- **根因**: **explore 模板不适配音频任务 + 精英保留比例过高导致多样性丧失**

#### dog-breed -- "指标方向混淆"导致反向优化

```
进化轨迹（5 次"突破"，↓越小越好）:
0.506 → 0.483 → 0.464 → 0.442 → 0.272
 [看似在改善，实际 Focal Loss ≠ logloss]
```

- 内部用 Focal Loss 评估（越小越好），测试用 logloss 评估 → 两个指标方向一致但**量级不同**
- 系统正确地在降低 Focal Loss（0.506→0.272），但 Focal Loss 会使概率分布变平，反而增大 logloss
- **根因**: **训练 Loss 与评估 Metric 不一致，进化选择压力作用在错误的指标上**

### 4.4 进化机制效率的定量评估

#### 进化效率（metric 改善 / 计算时间）

| 竞赛 | Δmetric | 时间 | 效率(%/h) | 方向 |
|------|---------|------|----------|------|
| detecting-insults | +0.0075 | 8h | +0.094 | 正向 |
| mlsp-birds | +0.040 | 5h | +0.81 | 正向（但绝对值不足） |
| plant-pathology | +0.0075 | 15h | +0.050 | 正向 |
| nomad2018 | -0.0049 | 13h | +0.038 | 正向 |
| histopathologic | +0.0009 | 29h | +0.003 | 正向（微调） |
| leaf-classif | -0.621 | 13h | **-4.8** | **反向** |
| dog-breed | -0.234 | 15h | **-1.6** | **反向** |

**结论**: 成功案例效率 0.003~0.81%/h（稳定正向），失败案例效率为负（进化反向运动）。

#### 进化突破点分析

| 竞赛 | 首次突破时间 | 最后突破时间 | 有效进化窗口 | 后续浪费 |
|------|-----------|-----------|-----------|---------|
| detecting-insults | 1h | 6h | 5h | 2h（收敛平台） |
| histopathologic | 5h | 20h | 15h | 9h（微调） |
| plant-pathology | 2h | 12h | 10h | 5h |
| nomad2018 | 1h | 11h | 10h | 2h |
| leaf-classif | 1h | 8h | 7h | **6h（纯浪费）** |
| mlsp-birds | 0.5h | 4h | 3.5h | **2h（停滞）** |

**关键发现**: 多数竞赛在 **前 60% 时间内完成所有有效突破**，后 40% 时间处于收敛平台或浪费状态。

### 4.5 LLM-GA 与传统 GA 的本质差异

Swarm-Ev2 的进化机制是 **LLM 驱动的遗传算法**，与传统 GA 存在本质差异：

| 维度 | 传统 GA | LLM-GA (Swarm-Ev2) |
|------|--------|-------------------|
| **基因表示** | 固定编码（二进制/浮点） | 代码文本（7 个语义基因块） |
| **交叉** | 位级/段级交换 | LLM 理解语义后选优合并 |
| **变异** | 随机翻转/高斯扰动 | LLM 定向改进单个基因块 |
| **适应度** | 精确可计算 | 依赖代码执行 + LLM Review（有噪声） |
| **同质父代效果** | 子代=父代（完全退化） | **仍可产生创意差异**（LLM 语义层面） |
| **失败模式** | 早熟收敛 | **代码不兼容 + metric 幻觉 + 指标混淆** |

**LLM-GA 独特的优势**:
- 同质父代的 merge 仍有意义（LLM 可在语义层面创新，如 histopathologic 的自交仍产生 +0.0001 改善）
- 变异是定向的（不是随机扰动，而是 LLM 理解基因块上下文后的有意改进）

**LLM-GA 独特的风险**:
- **代码兼容性不可预测**: 两个语法正确的父代 merge 可能产生语法/语义错误的子代
- **Review 幻觉**: LLM 可能将 buggy 代码判为正确（leaf-classif 的 metric=0.0 事件）
- **指标语义模糊**: LLM 可能混淆 training loss 和 evaluation metric

### 4.6 Agent 层进化的效果评估

Agent 层进化每 3 个 Epoch 触发一次，对弱者 Agent 进行 Role/Strategy 变异。

**观察到的效果**:

| 维度 | 数据 | 评估 |
|------|------|------|
| Agent 擅长度分化 | 多数竞赛中 4 个 Agent 的擅长度得分在 0.4~0.6 范围 | 分化不明显 |
| 弱者淘汰效果 | 被变异的 Agent 在后续 Epoch 的成功率无显著提升 | 有限 |
| 任务分配集中度 | 利用模式(70%)倾向于持续选择同一 Agent | 可能导致过度利用 |

**结论**: Agent 层进化在当前配置下**影响有限**。4 个 Agent 使用相同的基础 LLM（glm-4.7），差异主要来自 prompt 中的 Role 描述，进化改变 Role 的效果不如改变代码策略显著。Agent 进化的主要价值在于**任务分配优化**（让擅长 merge 的 Agent 做更多 merge），而非 Agent 能力本身的提升。

### 4.7 进化机制改进方向

基于以上分析，进化机制的核心改进方向：

| 问题 | 改进方案 | 预期效果 |
|------|---------|---------|
| **metric 幻觉** | 添加 metric 合理性上下界校验（logloss∈(0,∞), AUC∈[0,1]） | 防止 leaf-classif 类崩溃 |
| **代码兼容性** | merge 前做语法检查 + 基因块依赖分析 | 降低 merge BUGGY 率 10%+ |
| **进化停滞检测** | 连续 N 步（如 20 步）无 best 更新时触发"restart"（重新生成 3 个初稿） | 防止后期浪费 |
| **动态任务比例** | 前期 explore 50% / 中期 merge 60% / 后期 mutate 40% | 匹配进化阶段需求 |
| **指标对齐强制** | 在 prompt 中强制要求 validation metric 必须与竞赛 metric 一致 | 防止 dog-breed 类反向优化 |
| **多样性压力** | 降低 elite_size 从 3 到 2，或引入"岛屿模型"保持子种群独立进化 | 缓解 mlsp-birds 类同质化 |

---

## 五、改进方向优先级排序（按 ROI）

| 优先级 | 改进项 | 影响范围 | 预期收益 | 实现难度 |
|--------|--------|---------|---------|---------|
| **P0** | **引入 K-Fold CV 替代单一验证集** | 所有竞赛 | +2~3 枚奖牌 | 低 -- 修改评估管道 |
| **P0** | **修复 leaf-classif 特征丢弃 bug** | 1 个竞赛 | +1 枚奖牌（可能金牌） | 极低 -- 1行代码 |
| **P0** | **修复 denoising submission 格式** | 1 个竞赛 | +1 有效提交（内部 metric 已达金牌线） | 低 |
| **P0** | **增加 metric 合理性校验** | 全局 | 防止种群被虚假 metric 污染（leaf-classif logloss=0 事件） | 低 |
| **P0** | **增加 loss/metric 对齐检查** | 全局 | 防止 dog-breed 类指标错位（Focal Loss != logloss） | 低 |
| **P1** | **图像分类默认启用 TTA** | 6 个图像竞赛 | +1 枚奖牌（aerial-cactus -> 金） | 低 -- 推理阶段加 3 行 |
| **P1** | **降低 Buggy 率（代码模板/验证）** | 全局 | 等效增加 50%+ 搜索预算 | 中 -- 改进 prompt 和代码验证 |
| **P2** | **进化停滞检测 + 自动 restart** | 全局 | 节省后 40% 浪费时间（等效 +40% 搜索预算） | 低 -- 计数器 + 条件判断 |
| **P2** | **动态任务类型比例** | 全局 | 匹配进化阶段需求，提升 merge/mutate 时机精度 | 中 -- 修改调度器 |
| **P2** | **merge 前代码兼容性预检** | 全局 | 降低 merge BUGGY 率 10%+（当前 53.3%） | 中 -- AST 分析 |
| **P2** | **降低 elite_size 3→2** | 全局 | 缓解种群同质化（当前 25%→17%） | 极低 -- 改配置 |
| **P2** | **NLP 任务引入预训练词向量** | NLP 竞赛 | jigsaw 可突破中位数 | 中 -- 依赖管理 |
| **P2** | **提升图像分辨率（自适应）** | 细粒度图像 | aptos 可提升 0.02+ | 中 -- 动态调整 |
| **P3** | **修复 mlsp-birds explore 成功率** | 音频/特殊任务 | +1 超中位数 | 中 -- 诊断 explore 失败原因 |
| **P3** | **LLM API 稳定性（重试/降级）** | 3 个竞赛 | 避免 102 次失败浪费 | 中 |

---

## 六、具体 Action Items

### 立即执行（P0，预期 +3~4 枚奖牌）

1. **引入 K-Fold CV**: 在 SolutionEvolution 的评估管道中，将 `train_test_split` 替换为 `StratifiedKFold(n_splits=5)`，metric 取 5 fold 平均。直接解决内部-测试 Gap 问题
2. **修复 leaf-classification**: 在特征工程中保留原始 192 维特征（`X = pd.concat([original_features, engineered_features], axis=1)`）
3. **修复 denoising submission**: 确保遍历所有测试样本生成预测，验证 submission 行数；移除 `/ 255.0` 双重归一化
4. **增加 metric 合理性校验**: 对 logloss 等指标添加合理性上下界检查（logloss in (0, +inf), AUC in [0,1], RMSE in [0, +inf)），防止虚假 metric 污染种群
5. **增加 loss/metric 对齐检查**: 进化系统应强制要求 validation metric 与竞赛评估指标一致，禁止 Focal Loss 值被当作 logloss 使用

### 短期改进（P1，预期 +1~2 枚奖牌）

6. **图像分类默认 TTA**: 在 solution.py 模板中默认对测试集做水平翻转+垂直翻转+原始的 3 变换平均
7. **降低 Buggy 率**: 增加代码生成后的静态检查（import 验证、维度检查、输出格式验证）

### 中期优化（P2-P3）

8. **进化停滞检测 + 自动 restart**: 连续 20 步无 best 更新时触发 restart（重新生成 3 个初稿），避免后 40% 时间浪费在收敛平台上
9. **动态任务类型比例**: 前期 explore 50% → 中期 merge 60% → 后期 mutate 40%，替代当前固定 30:56:14 比例
10. **merge 前代码兼容性预检**: 语法检查 + 基因块依赖分析，降低 merge BUGGY 率
11. **降低 elite_size 从 3 到 2**: 缓解种群同质化（当前 3/12=25% 精英占比过高）
12. 为 NLP 任务增加 GloVe/FastText 词向量特征
13. 根据数据集大小自适应选择图像分辨率
14. 诊断并修复 mlsp-birds 的 explore 完全失败问题
15. 增加 LLM API 调用的重试和降级机制

---

## 附录：系统指标原始数据

### 核心指标汇总

| 竞赛 | Epoch | Step | 总评估 | 成功 | Buggy | 成功率 | 初始Metric | 最终最佳 | 改善幅度 | 超时 | LLM重试 | LLM失败 |
|------|-------|------|-------|------|-------|--------|-----------|---------|---------|------|---------|---------|
| aerial-cactus | 10 | 80 | 84 | 34 | 50 | 40.5% | 0.999692 | 1.000000 | +0.0% | 1 | 0 | 0 |
| aptos-blindness | 10 | 30 | 44 | 12 | 32 | 27.3% | 0.879200 | 0.922725 | +5.0% | 3 | 0 | 0 |
| denoising-docs | 10 | 40 | 52 | 18 | 34 | 34.6% | 0.083800 | 0.000791 | +99.1% | 10 | 0 | 0 |
| detecting-insults | 10 | 100 | 100 | 41 | 59 | 41.0% | 0.902237 | 0.909855 | +0.8% | 1 | 0 | 0 |
| dog-breed | 10 | 77 | 83 | 27 | 56 | 32.5% | 0.550309 | 0.272018 | +50.6% | 4 | 0 | 0 |
| dogs-vs-cats | 10 | 60 | 68 | 17 | 51 | 25.0% | 0.030044 | 0.008857 | +70.5% | 8 | 0 | 0 |
| histopath-cancer | 10 | 34 | 48 | 19 | 29 | 39.6% | 0.995687 | 0.997468 | +0.2% | 10 | 0 | 0 |
| jigsaw-toxic | 10 | 49 | 60 | 17 | 43 | 28.3% | 0.978001 | 0.987713 | +1.0% | 11 | 0 | 0 |
| leaf-classif | 10 | 90 | 92 | 17 | 75 | 18.5% | 0.751638 | 0.000000 | +100.0% | 13 | 0 | 0 |
| mlsp-birds | 10 | 100 | 100 | 20 | 80 | 20.0% | 0.653056 | 0.767158 | +17.5% | 0 | 0 | 0 |
| nomad-conductors | 10 | 59 | 68 | 24 | 44 | 35.3% | 0.062011 | 0.056973 | +8.1% | 12 | 19 | 21 |
| plant-pathology | 10 | 63 | 68 | 20 | 48 | 29.4% | 0.978600 | 0.987821 | +0.9% | 4 | 35 | 47 |
| random-pizza | 10 | 99 | 99 | 37 | 62 | 37.4% | 0.646968 | 0.686476 | +6.1% | 3 | 30 | 34 |

### 任务类型分布

| 竞赛 | explore | improve | mutate | merge | explore成功率 | improve成功率 | SolEvo成功率 | best更新次数 |
|------|---------|---------|--------|-------|-------------|-------------|-------------|------------|
| aerial-cactus | 108 | 60 | 18 | 108 | 37.5% | 41.7% | 46.0% | 2 |
| aptos-blindness | 68 | 20 | 2 | 14 | 41.7% | 10.0% | 50.0% | 6 |
| denoising-docs | 76 | 28 | 34 | 110 | 33.3% | 35.7% | 33.3% | 8 |
| detecting-insults | 124 | 76 | 22 | 116 | 41.7% | 40.8% | 31.9% | 9 |
| dog-breed | 107 | 59 | 38 | 86 | 29.2% | 33.9% | 37.1% | 5 |
| dogs-vs-cats | 92 | 44 | 22 | 88 | 16.7% | 29.5% | 36.4% | 5 |
| histopath-cancer | 72 | 24 | 22 | 114 | 58.3% | 20.8% | 91.2% | 3 |
| jigsaw-toxic | 84 | 36 | 16 | 108 | 16.7% | 36.1% | 45.2% | 2 |
| leaf-classif | 116 | 68 | 22 | 72 | 25.0% | 16.2% | 34.0% | 6 |
| mlsp-birds | 126 | 74 | 14 | 54 | 0.0% | 27.0% | 61.8% | 7 |
| nomad-conductors | 93 | 45 | 24 | 102 | 25.0% | 40.9% | 54.0% | 3 |
| plant-pathology | 97 | 49 | 26 | 108 | 27.3% | 30.4% | 37.9% | 5 |
| random-pizza | 125 | 77 | 36 | 122 | 37.5% | 37.3% | 46.8% | 12 |
